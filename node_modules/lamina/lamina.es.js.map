{"version":3,"file":"lamina.es.js","sources":["../src/utils/ExportUtils.ts","../src/debug.tsx","../src/index.tsx"],"sourcesContent":["import { SerializedLayer } from 'src/types'\r\nimport * as LAYERS from '../vanilla'\r\n\r\nfunction getPropsFromLayer(layer: SerializedLayer) {\r\n  // @ts-ignore\r\n  const constructor = LAYERS[layer.constructor]\r\n  const instance = new constructor()\r\n  let props = ''\r\n  Object.entries(layer.properties).forEach(([key, val]) => {\r\n    const defaultVal = constructor['u_' + key] ?? instance[key]\r\n\r\n    switch (key) {\r\n      case 'name':\r\n        if (val !== layer.constructor) props += ` ${key}={${JSON.stringify(val)}}`\r\n        break\r\n\r\n      case 'visible':\r\n        if (!val) props += ` ${key}={${JSON.stringify(val)}}`\r\n        break\r\n\r\n      default:\r\n        if (val !== defaultVal) props += ` ${key}={${JSON.stringify(val)}}`\r\n        break\r\n    }\r\n  })\r\n\r\n  return props\r\n}\r\n\r\nexport function serializedLayersToJSX(layers: SerializedLayer[], material: SerializedLayer) {\r\n  const materialProps = getPropsFromLayer(material)\r\n\r\n  const jsx = `\r\n    <LayerMaterial${materialProps}>\r\n      ${layers\r\n        .map((layer) => {\r\n          const props = getPropsFromLayer(layer)\r\n          return `<${layer.constructor}${props} />`\r\n        })\r\n        .join('\\n\\t')}\r\n    </LayerMaterial>\r\n    `\r\n\r\n  return jsx\r\n}\r\n\r\nfunction getJSPropsFromLayer(layer: SerializedLayer) {\r\n  // @ts-ignore\r\n  const constructor = LAYERS[layer.constructor];\r\n  const instance = new constructor();\r\n  let props = '\\t';\r\n  let entries = Object.entries(layer.properties);\r\n  entries.forEach(([key, val], idx) => {\r\n    var _constructor;\r\n    const eol = '\\n\\t\\t';\r\n    if (key.includes('color')) {\r\n      const v = typeof val === \"string\" ? val : '#' + val.getHexString();\r\n      props += `${key}: ${JSON.stringify(v)},${eol}`;\r\n    } else {\r\n      const defaultVal = (_constructor = constructor['u_' + key]) != null ? _constructor : instance[key];\r\n      switch (key) {\r\n        case 'name':\r\n          if (val !== layer.constructor) props += `${key}: ${JSON.stringify(val)},${eol}`;\r\n          break;\r\n          \r\n          case 'visible':\r\n            if (!val) props += `${key}:${JSON.stringify(val)},${eol}`;\r\n            break;\r\n            \r\n          default:\r\n            if (val !== defaultVal) props += `${key}: ${JSON.stringify(val)},${eol}`;\r\n            break;\r\n        }\r\n      }\r\n  });\r\n  return props;\r\n}\r\n\r\nexport function serializedLayersToJS(layers: SerializedLayer[], material: SerializedLayer){\r\n  const materialProps = getJSPropsFromLayer(material);\r\n  const jsLayers = `${layers.map(l => {\r\n    return `new ${l.constructor}({\r\n      ${getJSPropsFromLayer(l)}\r\n      })`\r\n  }).join(',\\n\\t\\t')}`\r\n\r\n  const js = `\r\n  new LayerMaterial({\r\n    ${materialProps}\r\n    layers: [\r\n      ${jsLayers}\r\n    ]\r\n  })`\r\n\r\n  return js;\r\n}\r\n","import { ElementProps, extend } from '@react-three/fiber'\r\nimport { createRoot } from 'react-dom/client'\r\n\r\nimport { button, LevaPanel, useControls, useCreateStore } from 'leva'\r\nimport { DataItem, StoreType } from 'leva/dist/declarations/src/types'\r\nimport React, { useImperativeHandle, useMemo } from 'react'\r\nimport {\r\n  Color,\r\n  MeshBasicMaterial,\r\n  MeshLambertMaterial,\r\n  MeshPhongMaterial,\r\n  MeshPhysicalMaterial,\r\n  MeshStandardMaterial,\r\n  MeshToonMaterial,\r\n  TextureLoader,\r\n} from 'three'\r\nimport { LayerMaterialProps, ShadingTypes } from './types'\r\nimport { serializedLayersToJS, serializedLayersToJSX } from './utils/ExportUtils'\r\nimport { getLayerMaterialArgs, getUniform } from './utils/Functions'\r\nimport * as LAYERS from './vanilla'\r\n\r\nextend({\r\n  LayerMaterial: LAYERS.LayerMaterial,\r\n})\r\n\r\nfunction DynamicLeva({\r\n  name,\r\n  layers,\r\n  store,\r\n  setUpdate,\r\n}: {\r\n  setUpdate: any\r\n  name: string\r\n  layers: any[]\r\n  store: StoreType\r\n}) {\r\n  useControls(\r\n    name,\r\n    () => {\r\n      const o: any = {}\r\n      layers.forEach((layer, i: number) => {\r\n        const n = `${layer.label} ~${i}`\r\n        o[n] = layer\r\n        o[n].onChange = () => setUpdate([`${name}.${n}`, layer.label])\r\n      })\r\n      return o\r\n    },\r\n    { store },\r\n    [layers, name]\r\n  )\r\n\r\n  return null\r\n}\r\n\r\ntype AllMaterialProps = ElementProps<typeof MeshPhongMaterial> & //\r\n  ElementProps<typeof MeshPhysicalMaterial> &\r\n  ElementProps<typeof MeshToonMaterial> &\r\n  ElementProps<typeof MeshBasicMaterial> &\r\n  ElementProps<typeof MeshLambertMaterial> &\r\n  ElementProps<typeof MeshStandardMaterial>\r\n\r\nconst DebugLayerMaterial = React.forwardRef<\r\n  LAYERS.LayerMaterial,\r\n  React.PropsWithChildren<LayerMaterialProps & Omit<AllMaterialProps, 'color'>>\r\n>(({ children, ...props }, forwardRef) => {\r\n  const ref = React.useRef<\r\n    LAYERS.LayerMaterial & {\r\n      [key: string]: any\r\n    }\r\n  >(null!)\r\n  useImperativeHandle(forwardRef, () => ref.current)\r\n  const store = useCreateStore()\r\n  const [layers, setLayers] = React.useState<{ [name: string]: any[] }>({})\r\n  const [path, setPath] = React.useState(['', ''])\r\n  const textureLoader = useMemo(() => new TextureLoader(), [])\r\n\r\n  useControls(\r\n    {\r\n      'Copy JSX': button(() => {\r\n        const serialized = ref.current.layers.map((l) => l.serialize())\r\n        const jsx = serializedLayersToJSX(serialized, ref.current.serialize())\r\n        navigator.clipboard.writeText(jsx)\r\n      }),\r\n      'Copy JS': button(() => {\r\n        const serialized = ref.current.layers.map((l) => l.serialize())\r\n        const js = serializedLayersToJS(serialized, ref.current.serialize())\r\n        navigator.clipboard.writeText(js)\r\n      }),\r\n    },\r\n    { store }\r\n  )\r\n\r\n  const { Lighting } = useControls(\r\n    'Base',\r\n    {\r\n      Color: {\r\n        value: '#' + new Color(ref.current?.color || props?.color || 'white').convertLinearToSRGB().getHexString(),\r\n        onChange: (v) => {\r\n          ref.current.color = v\r\n        },\r\n      },\r\n      Alpha: {\r\n        value: ref.current?.alpha || props?.alpha || 1,\r\n        min: 0,\r\n        max: 1,\r\n        onChange: (v) => {\r\n          ref.current.alpha = v\r\n        },\r\n      },\r\n      Lighting: {\r\n        value: ref.current?.lighting || props?.lighting || 'basic',\r\n        options: Object.keys(ShadingTypes),\r\n      },\r\n    },\r\n    { store }\r\n  )\r\n  const [args, otherProps] = useMemo(() => getLayerMaterialArgs({ ...props, lighting: Lighting }), [props, Lighting])\r\n\r\n  React.useEffect(() => {\r\n    const layers = ref.current.layers\r\n\r\n    const schema: { [name: string]: any[] } = {}\r\n    layers.forEach((layer: any, i: number) => {\r\n      if (layer.getSchema) schema[`${layer.name} ~${i}`] = layer.getSchema()\r\n    })\r\n\r\n    setLayers(schema)\r\n  }, [children])\r\n\r\n  React.useEffect(() => {\r\n    const data = store.getData()\r\n    const updatedData = data[path[0]] as DataItem & {\r\n      value: any\r\n    }\r\n    if (updatedData) {\r\n      const split = path[0].split('.')\r\n      const index = parseInt(split[0].split(' ~')[1])\r\n      const property = path[1]\r\n      const id = ref.current.layers[index].uuid\r\n      const uniform = ref.current.uniforms[`u_${id}_${property}`]\r\n      const layer = ref.current.layers[index] as LAYERS.Abstract & {\r\n        [key: string]: any\r\n      }\r\n\r\n      if (property !== 'map') {\r\n        layer[property] = updatedData.value\r\n        if (uniform) {\r\n          uniform.value = getUniform(updatedData.value)\r\n        } else {\r\n          layer.buildShaders(layer.constructor)\r\n          ref.current.refresh()\r\n        }\r\n      } else {\r\n        ;(async () => {\r\n          try {\r\n            if (updatedData.value) {\r\n              const t = await textureLoader.loadAsync(updatedData.value)\r\n              layer[property] = t\r\n              uniform.value = t\r\n            } else {\r\n              layer[property] = undefined\r\n              uniform.value = undefined\r\n            }\r\n          } catch (error) {\r\n            console.error(error)\r\n          }\r\n        })()\r\n      }\r\n    }\r\n  }, [path])\r\n\r\n  React.useLayoutEffect(() => {\r\n    ref.current.layers = (ref.current as any).__r3f.children?.map((l: any) => l.object)\r\n    ref.current.refresh()\r\n  }, [children, args])\r\n\r\n  React.useLayoutEffect(() => {\r\n    const root = document.body.querySelector('#root')\r\n    const div = document.createElement('div')\r\n\r\n    if (root) {\r\n      root.appendChild(div)\r\n      const levaRoot = createRoot(div)\r\n      levaRoot.render(\r\n        <LevaPanel\r\n          titleBar={{\r\n            title: props.name || ref.current.name,\r\n          }}\r\n          store={store}\r\n        />\r\n      )\r\n    }\r\n\r\n    return () => {\r\n      div.remove()\r\n    }\r\n  }, [props.name])\r\n\r\n  return (\r\n    <>\r\n      {Object.entries(layers).map(([name, layers], i) => (\r\n        <DynamicLeva key={`${name} ~${i}`} name={name} layers={layers} store={store} setUpdate={setPath} />\r\n      ))}\r\n      <layerMaterial args={[args]} ref={ref} {...otherProps}>\r\n        {children}\r\n      </layerMaterial>\r\n    </>\r\n  )\r\n})\r\n\r\nexport default DebugLayerMaterial\r\n","import { ElementProps, extend, ThreeElement } from '@react-three/fiber'\r\nimport React, { useImperativeHandle, useMemo } from 'react'\r\nimport {\r\n  MeshBasicMaterial,\r\n  MeshLambertMaterial,\r\n  MeshPhongMaterial,\r\n  MeshPhysicalMaterial,\r\n  MeshStandardMaterial,\r\n  MeshToonMaterial,\r\n} from 'three'\r\nimport DebugLayerMaterial from './debug'\r\nimport {\r\n  ColorProps,\r\n  DepthProps,\r\n  DisplaceProps,\r\n  FresnelProps,\r\n  GradientProps,\r\n  LayerMaterialProps,\r\n  MatcapProps,\r\n  NoiseProps,\r\n  NormalProps,\r\n  TextureProps,\r\n} from './types'\r\nimport { getLayerMaterialArgs } from './utils/Functions'\r\nimport * as LAYERS from './vanilla'\r\n\r\ndeclare module '@react-three/fiber' {\r\n  interface ThreeElements {\r\n    layerMaterial: ThreeElement<typeof LAYERS.LayerMaterial>\r\n    depth_: ThreeElement<typeof LAYERS.Depth>\r\n    color_: ThreeElement<typeof LAYERS.Color>\r\n    noise_: ThreeElement<typeof LAYERS.Noise>\r\n    fresnel_: ThreeElement<typeof LAYERS.Fresnel>\r\n    gradient_: ThreeElement<typeof LAYERS.Gradient>\r\n    matcap_: ThreeElement<typeof LAYERS.Matcap>\r\n    texture_: ThreeElement<typeof LAYERS.Texture>\r\n    displace_: ThreeElement<typeof LAYERS.Displace>\r\n    normal_: ThreeElement<typeof LAYERS.Normal>\r\n  }\r\n}\r\n\r\nextend({\r\n  LayerMaterial: LAYERS.LayerMaterial,\r\n  Depth_: LAYERS.Depth,\r\n  Color_: LAYERS.Color,\r\n  Noise_: LAYERS.Noise,\r\n  Fresnel_: LAYERS.Fresnel,\r\n  Gradient_: LAYERS.Gradient,\r\n  Matcap_: LAYERS.Matcap,\r\n  Texture_: LAYERS.Texture,\r\n  Displace_: LAYERS.Displace,\r\n  Normal_: LAYERS.Normal,\r\n})\r\n\r\nexport type AllMaterialProps = ElementProps<typeof MeshPhongMaterial> & //\r\n  ElementProps<typeof MeshPhysicalMaterial> &\r\n  ElementProps<typeof MeshToonMaterial> &\r\n  ElementProps<typeof MeshBasicMaterial> &\r\n  ElementProps<typeof MeshLambertMaterial> &\r\n  ElementProps<typeof MeshStandardMaterial>\r\n\r\nconst LayerMaterial = React.forwardRef<\r\n  LAYERS.LayerMaterial,\r\n  React.PropsWithChildren<LayerMaterialProps & Omit<AllMaterialProps, 'color'>>\r\n>(({ children, ...props }, forwardRef) => {\r\n  const ref = React.useRef<LAYERS.LayerMaterial>(null!)\r\n  useImperativeHandle(forwardRef, () => ref.current)\r\n\r\n  React.useLayoutEffect(() => {\r\n    ref.current.layers = (ref.current as any).__r3f.children?.map((l: any) => l.object)\r\n    ref.current.refresh()\r\n  }, [children])\r\n\r\n  const [args, otherProps] = useMemo(() => getLayerMaterialArgs(props), [props])\r\n\r\n  return (\r\n    <layerMaterial args={[args]} ref={ref} {...otherProps}>\r\n      {children}\r\n    </layerMaterial>\r\n  )\r\n})\r\n\r\nfunction getNonUniformArgs(props: any) {\r\n  return [\r\n    {\r\n      mode: props?.mode,\r\n      visible: props?.visible,\r\n      type: props?.type,\r\n      mapping: props?.mapping,\r\n      map: props?.map,\r\n      axes: props?.axes,\r\n    },\r\n  ] as any\r\n}\r\n\r\nconst Depth = React.forwardRef<LAYERS.Depth, DepthProps>((props, forwardRef) => {\r\n  //@ts-ignore\r\n  return <depth_ args={getNonUniformArgs(props)} ref={forwardRef} {...props} />\r\n}) as React.ForwardRefExoticComponent<DepthProps & React.RefAttributes<LAYERS.Depth>>\r\n\r\nconst Color = React.forwardRef<LAYERS.Color, ColorProps>((props, ref) => {\r\n  //@ts-ignore\r\n  return <color_ ref={ref} args={getNonUniformArgs(props)} {...props} />\r\n}) as React.ForwardRefExoticComponent<ColorProps & React.RefAttributes<LAYERS.Color>>\r\n\r\nconst Noise = React.forwardRef<LAYERS.Noise, NoiseProps>((props, ref) => {\r\n  //@ts-ignore\r\n  return <noise_ ref={ref} args={getNonUniformArgs(props)} {...props} />\r\n}) as React.ForwardRefExoticComponent<NoiseProps & React.RefAttributes<LAYERS.Noise>>\r\n\r\nconst Fresnel = React.forwardRef<LAYERS.Fresnel, FresnelProps>((props, ref) => {\r\n  //@ts-ignore\r\n  return <fresnel_ ref={ref} args={getNonUniformArgs(props)} {...props} />\r\n}) as React.ForwardRefExoticComponent<FresnelProps & React.RefAttributes<LAYERS.Fresnel>>\r\n\r\nconst Gradient = React.forwardRef<LAYERS.Gradient, GradientProps>((props, ref) => {\r\n  //@ts-ignore\r\n  return <gradient_ ref={ref} args={getNonUniformArgs(props)} {...props} />\r\n}) as React.ForwardRefExoticComponent<GradientProps & React.RefAttributes<LAYERS.Gradient>>\r\n\r\nconst Matcap = React.forwardRef<LAYERS.Matcap, MatcapProps>((props, ref) => {\r\n  //@ts-ignore\r\n  return <matcap_ ref={ref} args={getNonUniformArgs(props)} {...props} />\r\n}) as React.ForwardRefExoticComponent<MatcapProps & React.RefAttributes<LAYERS.Matcap>>\r\n\r\nconst Texture = React.forwardRef<LAYERS.Texture, TextureProps>((props, ref) => {\r\n  //@ts-ignore\r\n  return <texture_ ref={ref} args={getNonUniformArgs(props)} {...props} />\r\n}) as React.ForwardRefExoticComponent<TextureProps & React.RefAttributes<LAYERS.Texture>>\r\n\r\nconst Displace = React.forwardRef<LAYERS.Displace, DisplaceProps>((props, ref) => {\r\n  //@ts-ignore\r\n  return <displace_ ref={ref} args={getNonUniformArgs(props)} {...props} />\r\n}) as React.ForwardRefExoticComponent<DisplaceProps & React.RefAttributes<LAYERS.Displace>>\r\n\r\nconst Normal = React.forwardRef<LAYERS.Normal, NormalProps>((props, ref) => {\r\n  //@ts-ignore\r\n  return <normal_ ref={ref} args={getNonUniformArgs(props)} {...props} />\r\n}) as React.ForwardRefExoticComponent<NormalProps & React.RefAttributes<LAYERS.Normal>>\r\n\r\nexport { Color, DebugLayerMaterial, Depth, Displace, Fresnel, Gradient, LayerMaterial, Matcap, Noise, Normal, Texture }\r\n"],"names":["getPropsFromLayer","layer","constructor","LAYERS","instance","props","key","val","defaultVal","serializedLayersToJSX","layers","material","getJSPropsFromLayer","idx","_constructor","eol","v","serializedLayersToJS","materialProps","jsLayers","l","extend","LAYERS.LayerMaterial","DynamicLeva","name","store","setUpdate","useControls","o","n","DebugLayerMaterial","React","children","forwardRef","ref","useImperativeHandle","useCreateStore","setLayers","path","setPath","textureLoader","useMemo","TextureLoader","button","serialized","jsx","js","Lighting","Color","_a","_b","_c","ShadingTypes","args","otherProps","getLayerMaterialArgs","schema","i","updatedData","split","index","property","id","uniform","getUniform","t","error","root","div","createRoot","LevaPanel","jsxs","Fragment","LAYERS.Depth","LAYERS.Color","LAYERS.Noise","LAYERS.Fresnel","LAYERS.Gradient","LAYERS.Matcap","LAYERS.Texture","LAYERS.Displace","LAYERS.Normal","LayerMaterial","getNonUniformArgs","Depth","Noise","Fresnel","Gradient","Matcap","Texture","Displace","Normal"],"mappings":"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"}