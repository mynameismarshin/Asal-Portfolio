
import  { useRef } from 'react';
import { useGSAP } from '@gsap/react';
import gsap from 'gsap';
import { useBookStore } from '../store';

export function HandwrittenSignature({ onComplete }) {
  const containerRef = useRef(null);
  const pathsToAnimate = useRef([]); 
  const currentSection = useBookStore((state) => state.currentSection);
  const hasAnimated = useRef(false);

  useGSAP(() => {
    pathsToAnimate.current = gsap.utils.toArray('.draw-me', containerRef.current);
    if (currentSection === 3 && !hasAnimated.current && pathsToAnimate.current.length > 0) {
      const tl = gsap.timeline({
        
        onComplete: () => {
            if (onComplete) onComplete();
        }
      });
      pathsToAnimate.current.forEach(path => {
        const length = path.getTotalLength();
        gsap.set(path, { strokeDasharray: length, strokeDashoffset: length });
      });
      gsap.to(containerRef.current, { opacity: 1, duration: 0.5 });
      tl.to(pathsToAnimate.current[0], { strokeDashoffset: 0, duration: 2, ease: 'power1.inOut' })
        .to(pathsToAnimate.current[1], { strokeDashoffset: 0, duration: 1, ease: 'power2.out' })
        .to(pathsToAnimate.current[2], { strokeDashoffset: 0, duration: 0.8, ease: 'sine.out' });
      hasAnimated.current = true;
    }
  }, { scope: containerRef, dependencies: [currentSection] });

  return (
    <div ref={containerRef} className="w-full h-auto relative opacity-0">
      <svg viewBox="0 0 1006.64 570.59">
        <defs>
          <mask id="signatureMask">
            <rect width="100%" height="100%" fill="black" />
            
            <path
              className="draw-me"
              d="M39.51,237a178.7,178.7,0,0,0,50-2c9.79-1.82,9.59-2.7,22-5,20.65-3.81,28.06-2.65,46-6,11.93-2.22,13.94-4.69,27-7s13.41-.81,20-3c14.17-4.69,14.64-12.24,28-16,4.6-1.29,14.22-4,21,1,9.19,6.76,6.61,22.79,6,26-.87,4.64-2.7,9.45-12,22a271.6,271.6,0,0,1-27,31c-18.6,18.74-24.57,21.55-30,23-4.23,1.14-14,3.78-19-1-7.85-7.57,1.79-28.73,6-38,3.76-8.25,13.2-26.49,35-45,6.55-5.56,34.53-29.3,45-22,7.85,5.48,1.5,25.31,7,27,4.62,1.42,12.17-11.55,13-11s-9.63,16.28-18,36c-10.39,24.53-8.29,33.95-7,38,2,6.25,7,15.11,14,16,3.62.47,5.61-1.49,13-5,9.74-4.61,11.36-3.63,19-7,11.68-5.14,12.52-9.47,27-19,7-4.62,7.95-4.33,20-11,24.55-13.56,36.82-20.35,38-27,1.81-10.15-12-13.44-29-39-9.3-14-18.35-27.66-16-44,1.56-10.77,7.69-20,13-28a119.1,119.1,0,0,1,15-18,256.48,256.48,0,0,1,38-32c33.28-22.38,60.82-29.16,69-31,16.63-3.72,24.35-2.9,31,0,11.21,4.9,19.36,15.6,22,27,3.24,14-2.58,25.36-7,34-3.89,7.63-7,10.53-21,26-23.86,26.39-21.06,24.86-33,37-12.91,13.14-19.38,19.72-30,28-13.83,10.8-25.33,25.11-41,33-1.23.63-4.88,2.4-5,5-.19,4.18,15.38,14.7,18,17,16,14,25.24,32.54,28,43,9.28,35.1-11,60.56-15,68-11.57,21.51-30.71,33-69,56-27.48,16.51-53.92,28-79,24-6.14-1-12.34-2.89-16-8-8.17-11.4,1.9-31,6-39,12.09-23.52,30-37.22,42-46,39.52-28.86,59.29-43.3,93-57,59.33-24.09,70.61-9.27,91-31,19-20.26,31.35-29.5,56-48a8.9,8.9,0,0,1,6-2c5.94.66,11.1,9.86,11,18-.06,5.16-2.21,8.52-7,16-16,25-15.9,24.89-16,25-20,26-30.44,39.58-42,38-6.82-.92-13.41-7.05-16-14-10.25-27.52,43.66-64.56,60-86a8.41,8.41,0,0,1,4-3c5.7-1.81,14.68,3.62,18,11,1.67,3.7,1.18,6.26,3,7,3.53,1.43,9.27-6.54,10-6,1.22.91-17.54,20.44-23,46-.72,3.4-6.27,30.59,4,37,17,10.63,67.41-42,77-52a372.22,372.22,0,0,0,73-111s9.29-13.53,17-48c.5-2.21,1.4-6.62-1-10-3.16-4.46-10.52-5.6-16-4-3.52,1-6.39,3.22-13,12-8.75,11.64-12,18-12,18-15.11,29.66-20.61,32.81-36,67a552.62,552.62,0,0,0-29,82c-3.91,14.61-9.2,36.76-2,61,3.59,12.08,7.71,16,11,18,13,7.81,32.25-3.16,46-11,31.44-17.89,58.89-48.66,65-63a16.36,16.36,0,0,1,5-7c5-3.85,10.8-3,21-3,6,0,12-.9,18-1,11.12-.18,59.54-2.37,188-9"
              fill="none"
              stroke="white"
              strokeWidth="15"
            />
            <path
              className="draw-me"
              d="M210.88,511A1052.68,1052.68,0,0,1,717.5,375.25"
              fill="none"
              stroke="white"
              strokeWidth="30"
            />
            <path
              className="draw-me"
              d="M934,32c-2.89-.12-7.12-.29-12.22-.45C904.67,31,866.19,29.76,866,32c0,.49,1.71,1.24,11.56,3.13,31.16,6,50.35,5.41,50.44,6.87.15,2.54-57.45,11.3-59,5-.86-3.51,15.69-11.68,60-27"
              fill="none"
              stroke="white"
              strokeWidth="30"
            />
          </mask>
        </defs>
        
        
        <g mask="url(#signatureMask)">
          <path xmlns="http://www.w3.org/2000/svg" d="M397.17,228.83c5,4.53,9.23,8.3,13.39,12.13,8,7.31,15.62,14.92,20.74,24.58,2.47,4.67,5.15,5.71,10.44,3.77,8-2.95,16.58-4.4,24.79-6.86a181.65,181.65,0,0,0,19.11-6.82c1.95-.82,3.55-3.14,4.67-5.13,7.42-13.24,18.26-23.77,28.38-34.73,7.29-7.9,16.39-14.18,28.35-13.65,13.46.59,17.59,4.68,20.7,14.15,6.47-4.17,6.47-4.17,12.8-1.45-.69,2.88-1,6.11-2.24,8.91-4.07,9-8.75,17.77-12.71,26.83-4.43,10.13-7.51,20.62-6.76,31.95.6,8.91,5.76,12.69,14,9.36,7.63-3.07,15.09-6.28,20.31-13.47,2.94-4,7.94-6.51,11.49-10.19a17.4,17.4,0,0,0,4.68-8.11c3.73-19.47,9.67-38.31,16.72-56.75,11.45-29.95,24-59.43,40.79-86.93,6.39-10.49,12.24-21.4,19.5-31.26,5.43-7.36,10.79-15.29,20.48-18.58,10.87-3.69,20.13.62,21.79,11.89,1,6.54,1.36,13.76-.42,20-3.14,11-6.78,21.88-12.63,31.94-5.74,9.86-10.31,20.42-16.17,30.21-6.75,11.25-14.28,22-21.62,32.93-5.83,8.66-11.76,17.25-17.89,25.69-3,4.15-6.49,7.95-9.86,11.82-7.8,9-15.76,17.8-23.46,26.85-4.69,5.52-6.39,12.73-6.79,19.36a151.09,151.09,0,0,0,1.44,33.88c2.1,12.41,10.75,16.46,24,15.47,16.63-1.25,29.45-10.82,41.7-20.29,16.22-12.53,29-28.83,40.66-45.53,7-10.09,16.16-14.3,27.25-16.18,16.16-2.75,32.33-5.51,48.83-5,1.09,0,2.57.4,3.21-.15,6.31-5.51,13.84-2.61,20.81-3,14-.82,28.13-1.13,42.19-1.74,10.8-.47,21.6-1.11,32.41-1.59,13.51-.6,27-1,40.54-1.69,7.81-.38,15.6-1.1,23.4-1.54,1.87-.11,4.11-.29,5.57.59s3.62,3.19,3.48,4.68c-.2,2-2.07,4.06-3.68,5.61-.76.74-2.59.44-3.94.47-23.87.56-47.74,1-71.61,1.67q-24.37.65-48.75,1.65c-9.43.38-18.88.73-28.26,1.65-20,2-40,4.09-60,6.58-13.15,1.65-21.55,11-29.78,20.12-5.93,6.6-11.64,13.4-17.28,20.25-8.46,10.28-19.12,18-29.52,26.09-12.92,10.08-27,17.14-43.38,18.55-14.6,1.25-25-4.17-30-17.18-5.15-13.2-5-26.16-3.15-40-9,7-17.55,14.25-26.78,20.44-6.21,4.16-13.54,6.57-21.38,4.86-9.56-2.08-17.23-16.23-14.87-25.37a31.68,31.68,0,0,0,.91-11.77c-3.43,4.65-6.41,9.74-10.37,13.88-10.32,10.79-19.82,22.67-34.11,28.82-8.42,3.62-16.39,1.82-20.9-4.54-4-5.59-3.57-12-2.4-18,1.6-8.27,4.27-16.34,6.73-25.4l-43.84,13c2,8.25,3.61,15.69,5.66,23,3.69,13.18.54,25.76-4.43,37.61C433.71,352.56,424,366,412.71,378.5c-7.49,8.27-16.28,14.8-24.36,22.24-8.41,7.75-18.66,12.41-27.87,18.71-19,13-40.33,19.18-62.32,24.45-4.47,1.07-8.86,2.26-13.49,3-9.58,1.43-17-3.38-24.41-7.79-9.29-5.54-12.6-17.1-9.72-29.42,4.31-18.43,15.19-32.25,28.23-45.68,9-9.29,20.6-15.36,28.65-25.55,2.22-2.83,6.14-4.3,9.23-6.46,15.79-11,32.51-20.36,49.53-29.45,13.89-7.4,28.09-13.68,42.44-19.88,3.48-1.5,6.47-4.16,10.12-6.58-9.91-12.55-19.05-25.59-32.4-34.73-1.42-1-4.44-1.48-5.6-.65-9.47,6.81-20.46,11.25-28.93,19.75-4.6,4.61-11.15,7.26-16.73,10.91-11.29,7.38-22.44,15-33.81,22.22a125.1,125.1,0,0,1-17.77,9.81c-4.32,1.85-9.28,2.34-14,3.08-13.66,2.14-21.42-9.88-22.51-20.94-.7-7.12.84-14.45,1.32-21.69.11-1.61,0-3.24,0-5.31-12.36,14.2-24.66,27.71-38.69,39.74a67.75,67.75,0,0,1-24.61,14c-10.56,3.26-22.92-2.77-21.81-16.67.87-10.87,2-21.21,8-30.79s11-20.16,16.9-30c2.59-4.33,6.31-8,10.41-13-8.64,1.42-15.87,2.59-23.09,3.81-11.62,2-23.2,4.14-34.85,5.91-12.19,1.85-24.86,1.92-36.53,5.42-9.84,2.95-19.46,4-29.46,4.47-10.23.48-20.43,1.51-30.65,2.12-4.06.24-6.37-2-6.37-5.51,0-4.07,2.52-4.91,5.94-4.84s7.08,0,10.62,0A271.09,271.09,0,0,0,96,230c14.07-2,28.26-3.19,42.36-5.09,9.78-1.32,20.23-1.54,29.05-5.32,11.39-4.88,23.42-5.81,35-8.72,10.12-2.55,17.93-8.21,26-13.57,8.4-5.57,16.83-8,26.06-4,8.72,3.84,13.27,11.14,13.76,21.31,4.51-2.05,7.7-10.12,14.65-2.24-1,2.87-1.84,6.75-3.49,10.26-4.89,10.42-10.48,20.53-15,31.09-2.82,6.53-4.31,13.64-6.21,20.54a12.27,12.27,0,0,0,0,4.87c1.71,11.8,5.45,19.73,20.91,14.4,9.33-3.22,17.49-8.56,25.6-14.19s17.38-9.71,25.91-14.85q19.17-11.53,38-23.71c3.43-2.23,6.08-5.68,8.9-8.39-9.19-9.75-19.47-18.84-27.45-29.62-9.36-12.63-17.39-26.73-18-43a72.24,72.24,0,0,1,7.07-33.57,128.42,128.42,0,0,1,31.4-41.59,306.09,306.09,0,0,1,36.4-27.52C420.86,48,435.56,41.9,451.1,37c8-2.5,16-5.29,24.17-6.82,9-1.68,18.54-2.7,27.3.78,9.22,3.67,18.63,7.52,24.61,16.34A39.46,39.46,0,0,1,534,74.89c-2.45,19.25-11.26,35.39-25,49.32-10.41,10.51-19.1,22.69-29.26,33.47-9.79,10.38-20.29,20.12-30.83,29.74-9.24,8.42-18.54,16.79-29,23.85C412.53,216.27,405.74,222.16,397.17,228.83Zm-4.37-5.17c2.7-2.31,5.4-4.65,8.13-7,9.1-7.72,19.27-14,28.3-22,10.43-9.24,21.53-17.77,30.57-28.41,9.74-11.45,21.41-21.12,29.69-34,6.64-10.33,14.65-19.85,22.61-29.26,11.16-13.22,15.79-30.95,3.42-48.19a21.44,21.44,0,0,0-9.8-7.67c-12.34-5.13-24.75-3.31-37.28-.78a120.79,120.79,0,0,0-29,10.28c-12,5.83-24.48,10.21-35,19.17-8.63,7.37-18.17,13.5-26.6,21.45a144.7,144.7,0,0,0-21.6,25.93c-8.89,13.51-12.56,28.31-7.76,44.41,3.95,13.28,13.06,23.45,21.38,33.85C376.19,209.41,384.46,215.74,392.8,223.66Zm30.06,60.12c-13.24,6.75-26.36,10.93-38,18.81s-24.38,13.86-36.55,20.84c-11.28,6.48-22.49,12.95-32.81,21.09-17.84,14.07-34.33,29.2-47.89,47.56-5,6.83-7.07,14.29-8.34,22.17-1.09,6.76,2.5,12.49,8.76,15.5,9.31,4.47,18.93,2.76,28.57,1.54,12.56-1.58,23.66-7.29,35.08-12.11,3.22-1.36,6.55-2.5,9.69-4,18.55-9,34.86-21,50.09-35,14.08-12.92,25.37-27.39,33.54-44.57C433.36,318.07,430.87,301.31,422.86,283.78Zm202-36,1.92,1.19c10.33-12.94,21.18-25.51,30.86-38.92,12.82-17.75,25.17-35.8,35.17-55.45,8.25-16.24,16-32.56,21.56-49.9,2-6.18,3.81-12.37,3-18.92-.69-5.73-3.88-7.28-9.12-4.78-5.84,2.79-10,7.45-13.37,12.7-6.59,10.34-13.12,20.73-19.12,31.41-5.77,10.25-11.3,20.68-16.1,31.41-7.34,16.38-14.35,32.94-20.77,49.7C633.64,219.9,629.47,234,624.83,247.82ZM176.35,290.06a35.8,35.8,0,0,0,0,4.86c.67,4.79,6.74,8.45,10.54,6.12,5.82-3.57,11.74-7.13,17-11.48,5.71-4.77,10.79-10.32,15.93-15.74,5.73-6.05,11.27-12.28,16.79-18.52,7.32-8.27,13.32-17.37,16.91-27.91,1-3,2.52-6,2.93-9.06,1.06-8.1-4.43-13.5-12.25-11.11-6.76,2.07-14,4.86-19.13,9.47-14.69,13.3-28.32,27.74-37.74,45.52C182.61,271.08,176.06,279.22,176.35,290.06Zm314,7.68c6.71.47,7.86.45,12-2.61a162.06,162.06,0,0,0,19.27-16.75,230.58,230.58,0,0,0,25.84-31.63,48.1,48.1,0,0,0,8.17-26.39c.06-2.77-.88-4.78-3.93-5.13-2.63-.3-4.71.33-5.83,3.13-3.91,9.79-12.94,15.35-19.75,22.64-5.12,5.49-12.56,8.82-18.89,13.2a13.41,13.41,0,0,0-3.81,3.65c-2.5,4-4.82,8.2-7,12.43C492.07,278.7,489.33,287.5,490.38,297.74Z" />
          <path xmlns="http://www.w3.org/2000/svg" d="M210.88,510.1c6.06-8.76,15.51-11.26,23.57-15.8,18.78-10.6,38.74-18.77,58.12-28.11,14.57-7,30.14-11.54,44.32-19.07,16.33-8.66,34.26-12.84,51-20,24.13-10.35,50.08-14.53,74.7-22.94,24.14-8.25,49.23-11.23,74-16.06,7.62-1.49,15.74-1.2,22.93-3.72a73.85,73.85,0,0,1,15.3-3.32c7.18-.93,14.34-2.06,21.54-2.74,12.64-1.2,25.29-2.67,38-3,13-.35,26,.34,39.07.91,8.63.37,17.24,1.28,25.84,2.09a78.53,78.53,0,0,1,10.25,1.57c5.5,1.25,5.47,1.38,7.9,8.79-10.95-.92-21.36-1.76-31.77-2.68-3.48-.31-7-1.12-10.43-1.16-12-.14-24-.27-35.94,0-10.26.24-20.56.58-30.75,1.73-14.68,1.65-29.31,3.9-43.9,6.25-15.57,2.5-31.16,5-46.58,8.26-17,3.62-33.87,8.05-50.75,12.3-8.78,2.22-17.79,4-26.15,7.36-20.06,8-41.53,11.87-61.27,20.3-18.05,7.72-36.6,14.12-54.59,21.94-13.29,5.78-26.64,11.45-39.76,17.62-15.33,7.21-30.86,14.18-45.46,22.7-6.9,4-13.92,7.61-21.07,11C214.47,516.42,213.63,515.77,210.88,510.1Z"/>
        </g>
      </svg>
    </div>
  );
}

